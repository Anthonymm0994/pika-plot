<!DOCTYPE html>
<!-- saved from url=(0043)https://rerun.io/blog/primary-query-caching -->
<html lang="en" data-darkreader-proxy-injected="true"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <link rel="icon" href="https://rerun.io/favicon.svg">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
		<link href="./How we sped up time series by 20-30x — Rerun_files/0.DMHIBx0s.css" rel="stylesheet"><style class="darkreader darkreader--cors" media="screen">@keyframes fade-in{0%{opacity:0}to{opacity:1}}@keyframes fade-up{0%{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}:root{--header-height: 56px;--page-max-width: 1260px;--body-background: #101010;--body-text-color: #b2b2bb;--page-padding-y: 3rem;--color-link: #70f2b7;--code-block-background: #0c0c0c;--font-family-code: "JetBrains Mono";--radius-round: 10000px;--radius-600: 32px;--radius-500: 24px;--radius-400: 16px;--radius-300: 8px;--radius-200: 4px;--radius-100: 2px;color-scheme:dark}*{box-sizing:border-box;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;padding:0;margin:0;text-decoration:none;font-weight:inherit;font-size:inherit;line-height:inherit;list-style-type:none;font-family:inherit;color:inherit}html{font-family:Plus Jakarta Sans,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;font-size:17px;line-height:1.7;font-weight:425;scroll-padding-top:5rem;scrollbar-gutter:stable}@media screen and (max-width: 1078px){html{font-size:15px}}body{background:var(--body-background);color:var(--body-text-color);overflow:hidden;overflow-y:auto}img{display:block;max-width:100%;height:auto}iframe{display:block}h1,h2,h3,h4{color:#fff}iframe{border:none}button{font-family:inherit;border:none;cursor:pointer}.token.comment{color:#8e8e98}.token.rr-function,.token.rr-class,.token.function,.token.class-name,.token.builtin,.property{color:#ffdf89}.token.punctuation,.token.operator{color:#8e8e98}.token.keyword,.token.boolean{color:#e283ff}.token.string,.token.number{color:#5dfdb7}.twitter-tweet iframe{border-radius:12px}.button{display:inline-flex;align-items:center;gap:.4rem;padding:.25rem .75rem .35rem;font-weight:450;color:#fff;font-size:.875rem;text-align:center;background-color:#0f0f0f;border-color:#000;border:2px solid #262b2e;border-radius:10px;white-space:nowrap;transition:all .125s ease}.button:hover{background-color:#191a1b}.button span{margin-right:.1rem;font-size:1.15rem;line-height:1}.button.button-primary{border:none;color:#111;text-shadow:0 1px rgba(255,255,255,.33);box-shadow:inset 0 1px #fff,0 0 30px #fff3;background:#fff}.button.button-primary:hover{box-shadow:inset 0 1px #fff,0 0 30px #ffffff4d}.input{padding:.25rem .75rem .35rem;font-weight:450;color:#fff;font-size:.875rem;text-align:center;background-color:#0f0f0f;border-color:#000;border:2px solid #262b2e;border-radius:10px}.no-scroll{overflow:hidden;scrollbar-gutter:stable}</style><style class="darkreader darkreader--sync" media="screen"></style>
		<link href="./How we sped up time series by 20-30x — Rerun_files/Header.CsEQD0rE.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/MaxWidth.j6eJTfwM.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/3.BLts8VuD.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/FooterIcons.BrI9Wpbq.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/9.BXApCyZo.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/Markdown.CdgT4oda.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/Snippet.i3Q9v4lu.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/Typography.CRZcc-G9.css" rel="stylesheet">
		<link href="./How we sped up time series by 20-30x — Rerun_files/WebViewer.CsKAOcul.css" rel="stylesheet">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/entry/start.BaK2Nt-s.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/entry.CPcTEL5Q.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/runtime.gy0Jg4IF.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/index.BFqC5wTN.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/entry/app.DclAhdzP.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/preload-helper.CmsKOCeN.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/render.DGRuKnhE.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/props.DXeyqP4N.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/svelte-head.DYABy7tR.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/template.BWMa4Jvz.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/disclose-version.BDr9Qe-U.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/17.BHF8DP1f.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/this.BlzXT_cG.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/nodes/0.C-leFfCj.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/snippet.BJI5TUry.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/stores.YXVPGWC-.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/analytics.DTRJbmkH.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/config.DtlOAyum.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/nodes/2.93uzEmUU.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/Header.BrdrL_n8.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/legacy.CtaTdtmd.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/each.B090PHva.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/class.DUK75K3U.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/MaxWidth.BW-0xnk6.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/await.csnvjbi7.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/input.BC_vAGDD.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/util.svelte.B-n59lDz.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/nodes/3.CBKfT0IS.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/FooterIcons.D33r07Jm.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/nodes/9.DXI-dKea.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/Markdown.BqnqDOVx.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/Snippet.B1g3rkPr.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/Typography.yyPVTmN2.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/docs.CzjlM6uc.js">
		<link rel="modulepreload" href="https://rerun.io/_app/immutable/chunks/PageMeta.Dg3GHG59.js"><!--[--><meta name="viewport" content="width=device-width, initial-scale=1"><!--]--><!--[--><meta property="og:url" content="https://rerun.io"> <meta property="og:type" content="website"> <meta property="og:title" content="How we sped up time series by 20-30x"> <meta property="twitter:title" content="How we sped up time series by 20-30x"> <!--[--><meta name="description" content="This is a follow up post that dives into how we managed to achieve such huge performance gains for time series (among other things), and why it was so hard in the first place."> <meta property="og:description" content="This is a follow up post that dives into how we managed to achieve such huge performance gains for time series (among other things), and why it was so hard in the first place."><!--]--> <!--[--><meta property="og:image" content="https://rerun.io/blog/primary-query-caching/og.jpg"> <meta property="twitter:image" content="https://rerun.io/blog/primary-query-caching/og.jpg"> <meta property="twitter:description" content="This is a follow up post that dives into how we managed to achieve such huge performance gains for time series (among other things), and why it was so hard in the first place."><!--]--> <meta name="twitter:card" content="summary_large_image"><!--]--><title>How we sped up time series by 20-30x — Rerun</title>
  <link rel="modulepreload" as="script" crossorigin="" href="https://rerun.io/_app/immutable/nodes/1.CzTBOIt3.js"><link rel="stylesheet" crossorigin="" href="./How we sped up time series by 20-30x — Rerun_files/1.Cm2t82zk.css"><link rel="modulepreload" as="script" crossorigin="" href="https://rerun.io/_app/immutable/nodes/10.B-rQ0OKd.js"><link rel="modulepreload" as="script" crossorigin="" href="https://rerun.io/_app/immutable/nodes/11.CsF_Vrp9.js"><link rel="stylesheet" crossorigin="" href="./How we sped up time series by 20-30x — Rerun_files/11.C5cExOjU.css"><link rel="modulepreload" as="script" crossorigin="" href="https://rerun.io/_app/immutable/nodes/4.Cjg01gnP.js"><link rel="modulepreload" as="script" crossorigin="" href="https://rerun.io/_app/immutable/nodes/5.CSnanAf7.js"><link rel="stylesheet" crossorigin="" href="./How we sped up time series by 20-30x — Rerun_files/5.BB2H2CDW.css"><link rel="modulepreload" as="script" crossorigin="" href="https://rerun.io/_app/immutable/nodes/18.DhaUinMt.js"><link rel="stylesheet" crossorigin="" href="./How we sped up time series by 20-30x — Rerun_files/18.-BJGCH70.css"><link rel="modulepreload" as="script" crossorigin="" href="https://rerun.io/_app/immutable/nodes/8.CHzgBsGM.js"><link rel="stylesheet" crossorigin="" href="./How we sped up time series by 20-30x — Rerun_files/8.Cng42au6.css"></head>
  <body data-sveltekit-preload-data="hover">
    <div style="display: contents"><!--[--><!--[--><!----><!--[--><!----><div class="_Header_swggr_19"><div class="_HeaderBackdrop_swggr_211"></div> <div class="max-width _HeaderInner_swggr_30 svelte-1njj76d"><!--[--><h1><a href="https://rerun.io/">Rerun</a></h1> <nav><ul><!--[--><li><a href="https://rerun.io/careers" class="header-nav-item-careers" aria-current="false"><span class="_Label_swggr_111">Careers</span><!----></a><!----></li><li><a href="https://rerun.io/examples" class="header-nav-item-examples" aria-current="false"><span class="_Label_swggr_111">Examples</span><!----></a><!----></li><li><a href="https://rerun.io/docs/getting-started/what-is-rerun" class="header-nav-item-docs" aria-current="false"><span class="_Label_swggr_111">Docs</span><!----></a><!----></li><li><a href="https://rerun.io/blog" class="header-nav-item-blog" aria-current="page"><span class="_Label_swggr_111">Blog</span><!----></a><!----></li><li><a href="https://github.com/rerun-io/rerun" class="header-nav-item-github" aria-current="false"><span class="_Label_swggr_111">Github</span><!----></a><!----></li><li><a href="https://discord.gg/PXtCgFBSmH" class="header-nav-item-discord" aria-current="false"><span class="_Label_swggr_111">Discord</span><!----></a><!----></li><!--]--></ul></nav> <div class="container svelte-1ku5mz4"><button class="svelte-1ku5mz4 "><div class="search-icon svelte-1ku5mz4"></div> <span class="svelte-1ku5mz4"></span> <kbd class="svelte-1ku5mz4">/</kbd></button> <dialog class="svelte-2cmsw6"><div><div class="modal-content"><div class="search-box svelte-1ku5mz4"><input type="search" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" maxlength="256" placeholder="Search documentation" class="svelte-1ku5mz4"></div> <div class="results svelte-1ku5mz4"><!----><!----><a class="svelte-1ku5mz4" href="https://rerun.io/docs/getting-started/what-is-rerun"><div class="result-content svelte-1ku5mz4"><h2 class="svelte-1ku5mz4">Getting Started</h2> <p class="svelte-1ku5mz4">The fastest way to get started is with a quick start guide for C++, Python or Rust. If you are looking for other language support, search for an open issue on GitHub to find the…</p><!----> <div class="tags svelte-1ku5mz4"></div> <div class="breadcrumbs svelte-1ku5mz4"><span>Docs</span><span>›</span><span>Getting Started</span><span>›</span><span>What Is Rerun</span></div></div> <div class="nav-icon svelte-1ku5mz4"></div></a><a class="svelte-1ku5mz4" href="https://rerun.io/docs/getting-started/troubleshooting"><div class="result-content svelte-1ku5mz4"><h2 class="svelte-1ku5mz4">Troubleshooting</h2> <p class="svelte-1ku5mz4">You can set RUST_LOG=debug before running to get some verbose logging output. If you run into any issues don't hesitate to open a ticket or join our Discord.</p><!----> <div class="tags svelte-1ku5mz4"></div> <div class="breadcrumbs svelte-1ku5mz4"><span>Docs</span><span>›</span><span>Getting Started</span><span>›</span><span>Troubleshooting</span></div></div> <div class="nav-icon svelte-1ku5mz4"></div></a><a class="svelte-1ku5mz4" href="https://rerun.io/examples"><div class="result-content svelte-1ku5mz4"><h2 class="svelte-1ku5mz4">Examples</h2> <p class="svelte-1ku5mz4">The examples serve to showcase the Rerun logging SDK, and demonstrate the usage of Rerun to create visual walkthroughs of papers. To run these examples, make sure you have the…</p><!----> <div class="tags svelte-1ku5mz4"></div> <div class="breadcrumbs svelte-1ku5mz4"><span>Examples</span></div></div> <div class="nav-icon svelte-1ku5mz4"></div></a><a class="svelte-1ku5mz4" href="https://rerun.io/docs/reference/types/archetypes"><div class="result-content svelte-1ku5mz4"><h2 class="svelte-1ku5mz4">Archetypes</h2> <p class="svelte-1ku5mz4">Rerun comes with built-in support for a number of different types that can be logged via the Python and Rust Logging APIs and then visualized in the Viewer. The top-level types…</p><!----> <div class="tags svelte-1ku5mz4"></div> <div class="breadcrumbs svelte-1ku5mz4"><span>Docs</span><span>›</span><span>Reference</span><span>›</span><span>Types</span><span>›</span><span>Archetypes</span></div></div> <div class="nav-icon svelte-1ku5mz4"></div></a><!----></div></div><!----></div></dialog><!----></div><!----><!----><!--]--></div><!----></div><!----> <!--[--><!----><!--[!--><!----><!----> <div class="blog-post svelte-1g877uy"><div class="max-width svelte-1njj76d post page"><!--[--><div class="typography imageBleed"><h1 class="svelte-1g877uy">How we sped up time series by 20-30x</h1> <div class="byline svelte-1g877uy"><div class="avatar"><img src="./How we sped up time series by 20-30x — Rerun_files/avatar.jpg" alt="photo of Nikolaus West" width="32" height="32" class="svelte-1g877uy"></div> <div>Written by Nikolaus West <span title="2024-02-12T16:30:01">1 year ago</span></div></div> <!--[--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->This is a follow up post to the post <!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[--><!--[!--><!----><a href="https://rerun.io/blog/fast-plots">Real-time kHz time series in a multimodal visualizer</a><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!----> that dives into how we managed to achieve such huge performance gains for time series (among other things), and why it was so hard in the first place.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!----><img src="./How we sped up time series by 20-30x — Rerun_files/1M_series_before_v_after.png" alt="Before and after graph of time taken to draw a 1M point time series in Rerun"><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><em><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Comparison of time taken to draw a time series plot in Rerun with 1M points between version 0.12 and 0.13. The numbers come from profiling on a 2021 M1 MacBook Pro.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></em><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[--><h2 id="flexible-multimodal-data-is-hard-to-combine-with-fast-plots"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Flexible multimodal data is hard to combine with fast plots<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#flexible-multimodal-data-is-hard-to-combine-with-fast-plots" class="anchor-link"><span>flexible-multimodal-data-is-hard-to-combine-with-fast-plots</span></a><!----></h2><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Ever since the first release of Rerun, plotting larger time series has been painfully slow.
<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[--><!--[!--><!----><a href="https://github.com/rerun-io/rerun/releases/tag/0.13.0">0.13</a><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!----> is the first release where we think they're actually usable.
It’s worth taking a step back to explain why making plots fast in Rerun was hard, before getting into what we did about it.
To do that, we need some more background on how Rerun, the in-memory database, works.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="rerun-as-a-multimodal-time-series-database"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Rerun as a multimodal time series database<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#rerun-as-a-multimodal-time-series-database" class="anchor-link"><span>rerun-as-a-multimodal-time-series-database</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->One way of looking at Rerun is as an in-memory multimodal time series database with visualization on top.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[!--><ul><!--[!--><!--[--><li><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->You can throw many kinds of data at it, from simple metrics to big multi dimensional tensors, point clouds, and text documents.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></li><li><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Data is indexed along multiple user defined timelines, and can come in out of order.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></li><li><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->The Rerun data model is a temporal Entity Component System (ECS) that allows updating single components at a time.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></li><!--]--><!--]--><!----></ul><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Let's look at a small example of updating a colored point cloud in parts and out of order:<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!----><img src="./How we sped up time series by 20-30x — Rerun_files/data-model-example.png" alt="Overview of Rerun&#39;s ECS updated out of order"><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->For any given time point, the datastore needs to be able to collect the latest components of any entity, and join them against the primary component (3D positions in this case). Queries run every time Rerun renders a frame, which should be 60 times per second.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Getting all this to be both correct and fast took considerable effort during the first year of Rerun. The combination of all these features is what makes Rerun so versatile and easy to use.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[--><div class="embed-container svelte-1ie3fup"><iframe id="video/910960113" src="./How we sped up time series by 20-30x — Rerun_files/910960113.html" allow="autoplay; fullscreen; picture-in-picture" style="aspect-ratio: 1920 / 1080;" class="svelte-1ie3fup"></iframe></div><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="overhead-from-flexibility-make-simple-time-series-the-worst-case"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Overhead from flexibility make simple time series the worst case<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#overhead-from-flexibility-make-simple-time-series-the-worst-case" class="anchor-link"><span>overhead-from-flexibility-make-simple-time-series-the-worst-case</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Flexibility comes at the cost of added overhead. That matters less for larger data, but dominates performance for small data like scalars. In Rerun, time series are created by querying the datastore for all scalars on an entity for a range of time.
Before 0.13, the worst case was therefore simple time series plots, since you'd have to pay all that overhead many times for very little data.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[--><h2 id="speeding-up-time-series-by-a-factor-of-2030"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Speeding up time series by a factor of 20-30<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#speeding-up-time-series-by-a-factor-of-2030" class="anchor-link"><span>speeding-up-time-series-by-a-factor-of-2030</span></a><!----></h2><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->On Rerun 0.12, rendering a single frame of a 1M point time series plot takes ~600ms on a 2021 M1 MacBook Pro. On 0.13 it takes ~20ms, a 30x speedup. For smaller series the speedup tends to come closer to 20x, which is still huge. How did we get there?<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="sources-of-overhead-in-time-series-plots"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Sources of overhead in time series plots<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#sources-of-overhead-in-time-series-plots" class="anchor-link"><span>sources-of-overhead-in-time-series-plots</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Let’s sum up the main sources of overhead in producing data for and rendering a time series plot:<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><ol><!--[!--><!--[--><li><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><strong><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Bookkeeping<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></strong><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->: Keeping track of which components exist at each timestamp is relatively costly for small data.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></li><li><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><strong><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Data locality<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></strong><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->: For small data, the flexible data model (both in time and data type) bottoms out in a lack of data locality, which is bad for CPU cache efficiency.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></li><li><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><strong><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Redundant work<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></strong><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->: When plotting a moving time window, data is usually only changing at the edges of the window. Repeatedly running the full range query creates lots of redundant work.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></li><li><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><strong><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Rendering<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></strong><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->: For large time series, there may be more points than pixels to draw them on along the time dimension (x-axis). This leads to redundant tessellation and overdraw in the rendering pipeline.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></li><!--]--><!--]--><!----></ol><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="why-we-didnt-just-special-case-metrics"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Why we didn't just special case metrics<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#why-we-didnt-just-special-case-metrics" class="anchor-link"><span>why-we-didnt-just-special-case-metrics</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->The easiest solution for speeding up time series plots would be to special case the path for metrics. A specialized code path for simple metrics would make huge gains relatively easy.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Unfortunately this isn’t good enough because our users need good performance for more kinds of range queries. Here is an example using time ranges to show an aggregate point cloud in a structure from motion setting:<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[--><div class="embed-container svelte-1ie3fup"><iframe id="video/910977084" src="./How we sped up time series by 20-30x — Rerun_files/910977084.html" allow="autoplay; fullscreen; picture-in-picture" style="aspect-ratio: 1920 / 1080;" class="svelte-1ie3fup"></iframe></div><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->In addition, our motivating example for kHz plots was <!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[--><!--[!--><!----><a href="https://en.wikipedia.org/wiki/Inertial_measurement_unit">IMU</a><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!----> samples, which usually come as messages containing multiple values to plot. That makes special casing the single metrics less useful. For example:<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[--><div class="highlighted-code svelte-b0my99"><button aria-label="copy code" class="svelte-b0my99 "></button> <pre class="language-cpp" tabindex="0"><code class="svelte-b0my99 language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token keyword">float</span> acc<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">float</span> gyro<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// &lt;- Want to plot these as time series</span>

    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> timestamp<span class="token punctuation">;</span>
<span class="token punctuation">}</span> IMUSample<span class="token punctuation">;</span></code></pre></div><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Rerun doesn’t yet support visualizing time series from single fields of larger structs directly, but we will soon and our approach needs to support this as a first class use-case.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="caching-is-difficult-but-necessary"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Caching is difficult but necessary<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#caching-is-difficult-but-necessary" class="anchor-link"><span>caching-is-difficult-but-necessary</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><blockquote><!--[--><!--[--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->There are only two hard things in Computer Science: cache invalidation and naming things.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Phil Karlton<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--></blockquote><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->The non-rendering sources of overhead just scream caching, but as usual the devil is in the details, in particular the details of cache invalidation. In our case, out of order insertions combined with composing multiple components over time make invalidation particularly gnarly.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="datastore-changelogs-make-invalidation-manageable"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Datastore changelogs make invalidation manageable<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#datastore-changelogs-make-invalidation-manageable" class="anchor-link"><span>datastore-changelogs-make-invalidation-manageable</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Except for garbage collection (dropping old data to free up memory), the Rerun datastore is immutable. Data is always dropped through snapshotting so that query semantics are left unchanged. Every single change results in adding or removing rows to the store.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->The first step we took after deciding it was time for caching was a refactor that turned every system that maintains a derived dataset in Rerun (timeline widget, view heuristics engine, etc) into a store subscriber, which listens to changelogs of added or removed rows in the datastore.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Cache invalidation is yet another store subscriber, and having this protocol in place is what made it manageable to deal with all the complexity.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="caches-are-built-lazily-at-query-time"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Caches are built lazily at query time<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#caches-are-built-lazily-at-query-time" class="anchor-link"><span>caches-are-built-lazily-at-query-time</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Cache invalidation only sets a dirty flag. Actually building the cache happens lazily at query time. Since Rerun uses an end to end immediate mode architecture, we query the datastore on every frame, ideally 60 times per second.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->This acts as a natural micro-batching mechanism where we first accumulate changes while we render the current frame and then handle all these changes at the start of the next frame. Batching updates like this is great for performance.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Visible views query the datastore right before rendering. Building caches lazily therefore means we never spend time updating a cache that isn’t used.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="multitenancy-requires-fine-grained-locking"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Multi-tenancy requires fine grained locking<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#multitenancy-requires-fine-grained-locking" class="anchor-link"><span>multitenancy-requires-fine-grained-locking</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->When not on the web, each space view (draggable visualization panel) runs and queries the datastore in parallel. Many of these queries might overlap so we need to make sure to share data and cache resources appropriately.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Supporting this multi-tenancy requires fine grained locking on the combination of store (there are multiple), entity, set of components, and the component “point of view” (the component we join against).<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="aggregating-subpixel-points-speeds-up-rendering"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Aggregating sub-pixel points speeds up rendering<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#aggregating-subpixel-points-speeds-up-rendering" class="anchor-link"><span>aggregating-subpixel-points-speeds-up-rendering</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->There are only so many pixels available to draw on along the x-axis. For large time series, that means you need to aggregate points that would show up on the same x-axis tick to avoid overdraw and redundant tessellation in the render pipeline.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[--><div class="embed-container svelte-1ie3fup"><iframe id="video/910983296" src="./How we sped up time series by 20-30x — Rerun_files/910983296.html" allow="autoplay; fullscreen; picture-in-picture" style="aspect-ratio: 1920 / 1080;" class="svelte-1ie3fup"></iframe></div><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->We compute these aggregations on every frame and let users choose between a set of basic options.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[!--><!--[--><h3 id="a-caveat-on-performance-for-out-of-order-logs"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->A caveat on performance for out of order logs<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#a-caveat-on-performance-for-out-of-order-logs" class="anchor-link"><span>a-caveat-on-performance-for-out-of-order-logs</span></a><!----></h3><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->The speedups added in 0.13 slow down ingestion speed for out of order logs.
In practice this only matters for scalars logged out of order at high frequency,
but it does mean that live time series plots are slow in this case.
An update that fixes this is planned for 0.13.1.
Follow the progress <!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[--><!--[!--><!----><a href="https://github.com/rerun-io/rerun/issues/4810">here</a><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[--><!--[--><h2 id="huge-wins-already-but-there-is-more-to-be-had"><!--[--><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Huge wins already but there is more to be had<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--> <a href="https://rerun.io/blog/primary-query-caching#huge-wins-already-but-there-is-more-to-be-had" class="anchor-link"><span>huge-wins-already-but-there-is-more-to-be-had</span></a><!----></h2><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Adding a caching layer to the Rerun datastore has taken lots of effort over the last months, but the performance gains are clearly worth the added complexity.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->There are still lots of gains to be had by adding secondary caches on top, for scalars and other data. For example, slowly changing 3D geometry could be cached on the GPU to avoid redundant CPU -&gt; GPU transfers, which are currently the performance bottleneck for point clouds.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[--><span></span><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[--><!--[!--><!--[!--><!--[!--><!--[--><p><!--[--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->Join us on <!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[--><!--[!--><!----><a href="https://github.com/rerun-io/rerun">Github</a><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!----> or <!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[--><!--[!--><!----><a href="https://discord.gg/PXtCgFBSmH">Discord</a><!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!--[!--><!---->
and let us know what if these performance improvement made a difference for you,
and what areas you'd love to see us speed up next.<!----><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----></p><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!--]--><!----><!----></div><!----><!--]--></div><!----></div><!----><!--]--><!----> <div class="footer svelte-7dmj5o"><div class="max-width  svelte-1njj76d"><!--[--><div class="icons svelte-7dmj5o"><ul class="svelte-1nwgq25 "><li class="github svelte-1nwgq25"><a href="https://github.com/rerun-io/rerun" class="svelte-1nwgq25">GitHub</a></li> <li class="discord svelte-1nwgq25"><a href="https://discord.gg/PXtCgFBSmH" class="svelte-1nwgq25">Discord</a></li> <li class="linkedin svelte-1nwgq25"><a href="https://www.linkedin.com/company/rerun-io/" class="svelte-1nwgq25">LinkedIn</a></li> <li class="twitter svelte-1nwgq25"><a href="https://twitter.com/rerundotio" class="svelte-1nwgq25">Twitter</a></li></ul><!----></div> <div class="links svelte-7dmj5o"><!--[--><a href="https://rerun.io/docs/getting-started/what-is-rerun" class="svelte-7dmj5o">Docs</a><a href="https://rerun.io/blog" class="svelte-7dmj5o">Blog</a><a href="https://rerun.io/examples" class="svelte-7dmj5o">Examples</a><a href="https://rerun.io/team" class="svelte-7dmj5o">Team</a><a href="https://rerun.io/careers" class="svelte-7dmj5o">Careers</a><!--]--></div> <!--[!--><!--]--> <a href="https://rerun.io/privacy" class="svelte-7dmj5o">Privacy policy</a><!----><!--]--></div><!----></div><!----><!----><!--]--><!----><!----><!--]--><!----><!----><!--]--> <!--[!--><div id="svelte-announcer" aria-live="assertive" aria-atomic="true" style="position: absolute; left: 0; top: 0; clip: rect(0 0 0 0); clip-path: inset(50%); overflow: hidden; white-space: nowrap; width: 1px; height: 1px"><!----></div><!--]--><!--]-->
			
			<script id="fathom-script" async="" data-site="VWDZFCRS" src="./How we sped up time series by 20-30x — Rerun_files/script.js.download"></script><script>
				{
					__sveltekit_1p41x18 = {
						base: new URL("..", location).pathname.slice(0, -1)
					};

					const element = document.currentScript.parentElement;

					const data = [{"type":"data","data":null,"uses":{}},null,null,{"type":"data","data":{post:{id:"primary-query-caching",title:"How we sped up time series by 20-30x",description:"This is a follow up post that dives into how we managed to achieve such huge performance gains for time series (among other things), and why it was so hard in the first place.",author:{id:"nikolaus-west",name:"Nikolaus West"},date:"2024-02-12T16:30:01",content:"This is a follow up post to the post [Real-time kHz time series in a multimodal visualizer](/blog/fast-plots) that dives into how we managed to achieve such huge performance gains for time series (among other things), and why it was so hard in the first place.\n\n![Before and after graph of time taken to draw a 1M point time series in Rerun](/blog/1M_series_before_v_after.png)\n\n_Comparison of time taken to draw a time series plot in Rerun with 1M points between version 0.12 and 0.13. The numbers come from profiling on a 2021 M1 MacBook Pro._\n\n## Flexible multimodal data is hard to combine with fast plots\n\nEver since the first release of Rerun, plotting larger time series has been painfully slow.\n[0.13](https://github.com/rerun-io/rerun/releases/tag/0.13.0) is the first release where we think they're actually usable.\nIt’s worth taking a step back to explain why making plots fast in Rerun was hard, before getting into what we did about it.\nTo do that, we need some more background on how Rerun, the in-memory database, works.\n\n### Rerun as a multimodal time series database\n\nOne way of looking at Rerun is as an in-memory multimodal time series database with visualization on top.\n\n-   You can throw many kinds of data at it, from simple metrics to big multi dimensional tensors, point clouds, and text documents.\n-   Data is indexed along multiple user defined timelines, and can come in out of order.\n-   The Rerun data model is a temporal Entity Component System (ECS) that allows updating single components at a time.\n\nLet's look at a small example of updating a colored point cloud in parts and out of order:\n\n![Overview of Rerun's ECS updated out of order](/blog/data-model-example.png)\n\nFor any given time point, the datastore needs to be able to collect the latest components of any entity, and join them against the primary component (3D positions in this case). Queries run every time Rerun renders a frame, which should be 60 times per second.\n\nGetting all this to be both correct and fast took considerable effort during the first year of Rerun. The combination of all these features is what makes Rerun so versatile and easy to use.\n\nhttps://vimeo.com/910960113?autoplay=1&loop=1&autopause=0&background=1&muted=1&ratio=1920:1080\n\n### Overhead from flexibility make simple time series the worst case\n\nFlexibility comes at the cost of added overhead. That matters less for larger data, but dominates performance for small data like scalars. In Rerun, time series are created by querying the datastore for all scalars on an entity for a range of time.\nBefore 0.13, the worst case was therefore simple time series plots, since you'd have to pay all that overhead many times for very little data.\n\n## Speeding up time series by a factor of 20-30\n\nOn Rerun 0.12, rendering a single frame of a 1M point time series plot takes ~600ms on a 2021 M1 MacBook Pro. On 0.13 it takes ~20ms, a 30x speedup. For smaller series the speedup tends to come closer to 20x, which is still huge. How did we get there?\n\n### Sources of overhead in time series plots\n\nLet’s sum up the main sources of overhead in producing data for and rendering a time series plot:\n\n1. **Bookkeeping**: Keeping track of which components exist at each timestamp is relatively costly for small data.\n2. **Data locality**: For small data, the flexible data model (both in time and data type) bottoms out in a lack of data locality, which is bad for CPU cache efficiency.\n3. **Redundant work**: When plotting a moving time window, data is usually only changing at the edges of the window. Repeatedly running the full range query creates lots of redundant work.\n4. **Rendering**: For large time series, there may be more points than pixels to draw them on along the time dimension (x-axis). This leads to redundant tessellation and overdraw in the rendering pipeline.\n\n### Why we didn't just special case metrics\n\nThe easiest solution for speeding up time series plots would be to special case the path for metrics. A specialized code path for simple metrics would make huge gains relatively easy.\n\nUnfortunately this isn’t good enough because our users need good performance for more kinds of range queries. Here is an example using time ranges to show an aggregate point cloud in a structure from motion setting:\n\nhttps://vimeo.com/910977084?autoplay=1&loop=1&autopause=0&background=1&muted=1&ratio=1920:1080\n\nIn addition, our motivating example for kHz plots was [IMU](https://en.wikipedia.org/wiki/Inertial_measurement_unit) samples, which usually come as messages containing multiple values to plot. That makes special casing the single metrics less useful. For example:\n\n```cpp\ntypedef struct {\n    float acc[3];\n\n    float gyro[3];  // \u003C- Want to plot these as time series\n\n    unsigned long timestamp;\n} IMUSample;\n```\n\nRerun doesn’t yet support visualizing time series from single fields of larger structs directly, but we will soon and our approach needs to support this as a first class use-case.\n\n### Caching is difficult but necessary\n\n> There are only two hard things in Computer Science: cache invalidation and naming things.\n>\n> Phil Karlton\n\nThe non-rendering sources of overhead just scream caching, but as usual the devil is in the details, in particular the details of cache invalidation. In our case, out of order insertions combined with composing multiple components over time make invalidation particularly gnarly.\n\n### Datastore changelogs make invalidation manageable\n\nExcept for garbage collection (dropping old data to free up memory), the Rerun datastore is immutable. Data is always dropped through snapshotting so that query semantics are left unchanged. Every single change results in adding or removing rows to the store.\n\nThe first step we took after deciding it was time for caching was a refactor that turned every system that maintains a derived dataset in Rerun (timeline widget, view heuristics engine, etc) into a store subscriber, which listens to changelogs of added or removed rows in the datastore.\n\nCache invalidation is yet another store subscriber, and having this protocol in place is what made it manageable to deal with all the complexity.\n\n### Caches are built lazily at query time\n\nCache invalidation only sets a dirty flag. Actually building the cache happens lazily at query time. Since Rerun uses an end to end immediate mode architecture, we query the datastore on every frame, ideally 60 times per second.\n\nThis acts as a natural micro-batching mechanism where we first accumulate changes while we render the current frame and then handle all these changes at the start of the next frame. Batching updates like this is great for performance.\n\nVisible views query the datastore right before rendering. Building caches lazily therefore means we never spend time updating a cache that isn’t used.\n\n### Multi-tenancy requires fine grained locking\n\nWhen not on the web, each space view (draggable visualization panel) runs and queries the datastore in parallel. Many of these queries might overlap so we need to make sure to share data and cache resources appropriately.\n\nSupporting this multi-tenancy requires fine grained locking on the combination of store (there are multiple), entity, set of components, and the component “point of view” (the component we join against).\n\n### Aggregating sub-pixel points speeds up rendering\n\nThere are only so many pixels available to draw on along the x-axis. For large time series, that means you need to aggregate points that would show up on the same x-axis tick to avoid overdraw and redundant tessellation in the render pipeline.\n\nhttps://vimeo.com/910983296?autoplay=1&loop=1&autopause=0&background=1&muted=1&ratio=1920:1080\n\nWe compute these aggregations on every frame and let users choose between a set of basic options.\n\n### A caveat on performance for out of order logs\n\nThe speedups added in 0.13 slow down ingestion speed for out of order logs.\nIn practice this only matters for scalars logged out of order at high frequency,\nbut it does mean that live time series plots are slow in this case.\nAn update that fixes this is planned for 0.13.1.\nFollow the progress [here](https://github.com/rerun-io/rerun/issues/4810).\n\n## Huge wins already but there is more to be had\n\nAdding a caching layer to the Rerun datastore has taken lots of effort over the last months, but the performance gains are clearly worth the added complexity.\n\nThere are still lots of gains to be had by adding secondary caches on top, for scalars and other data. For example, slowly changing 3D geometry could be cached on the GPU to avoid redundant CPU -> GPU transfers, which are currently the performance bottleneck for point clouds.\n\nJoin us on [Github](https://github.com/rerun-io/rerun) or [Discord](https://discord.gg/PXtCgFBSmH)\nand let us know what if these performance improvement made a difference for you,\nand what areas you'd love to see us speed up next."},snippets:{sources:{},rrdUrls:{}}},"uses":{"params":["id"]}}];

					Promise.all([
						import("../_app/immutable/entry/start.BaK2Nt-s.js"),
						import("../_app/immutable/entry/app.DclAhdzP.js")
					]).then(([kit, app]) => {
						kit.start(app, element, {
							node_ids: [0, 2, 3, 9],
							data,
							form: null,
							error: null
						});
					});
				}
			</script>
		</div>
  

</body></html>