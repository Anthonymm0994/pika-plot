<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arrow Debug Test</title>
    <!-- Apache Arrow JS -->
    <script src="https://unpkg.com/apache-arrow@12.0.1/dist/Arrow.es2015.min.js"></script>
    <!-- Arquero for data manipulation -->
    <script src="https://unpkg.com/arquero@5.3.0/dist/arquero.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px; margin: 5px; }
        #output { white-space: pre-wrap; background: #f5f5f5; padding: 10px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Arrow File Debug Test</h1>
    
    <div class="test-section">
        <h2>Library Loading Test</h2>
        <button onclick="testLibraries()">Test Libraries</button>
        <div id="libraryOutput"></div>
    </div>
    
    <div class="test-section">
        <h2>File Loading Test</h2>
        <input type="file" id="fileInput" accept=".arrow" />
        <button onclick="testFileLoading()">Test File Loading</button>
        <div id="fileOutput"></div>
    </div>
    
    <div class="test-section">
        <h2>Console Output</h2>
        <div id="output"></div>
    </div>

    <script>
        // Override console.log to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const outputDiv = document.getElementById('output');
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            outputDiv.textContent += 'LOG: ' + args.join(' ') + '\n';
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            outputDiv.textContent += 'ERROR: ' + args.join(' ') + '\n';
        };

        function testLibraries() {
            const output = document.getElementById('libraryOutput');
            output.innerHTML = '';
            
            try {
                if (typeof Arrow === 'undefined') {
                    throw new Error('Arrow library not loaded');
                }
                if (typeof aq === 'undefined') {
                    throw new Error('Arquero library not loaded');
                }
                
                output.innerHTML = '<div class="success">✅ All libraries loaded successfully</div>';
                console.log('Libraries loaded:', { Arrow: typeof Arrow, Arquero: typeof aq });
            } catch (error) {
                output.innerHTML = '<div class="error">❌ ' + error.message + '</div>';
            }
        }

        function testFileLoading() {
            const fileInput = document.getElementById('fileInput');
            const output = document.getElementById('fileOutput');
            
            if (fileInput.files.length === 0) {
                output.innerHTML = '<div class="error">Please select a file first</div>';
                return;
            }
            
            const file = fileInput.files[0];
            output.innerHTML = '<div class="info">Testing file: ' + file.name + ' (' + file.size + ' bytes)</div>';
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const arrayBuffer = e.target.result;
                console.log('File loaded, size:', arrayBuffer.byteLength);
                
                try {
                    const uint8Array = new Uint8Array(arrayBuffer);
                    console.log('First 32 bytes:', Array.from(uint8Array.slice(0, 32)));
                    
                    // Try parsing with different methods
                    let table;
                    if (typeof Arrow.Table !== 'undefined' && typeof Arrow.Table.from === 'function') {
                        table = Arrow.Table.from(uint8Array);
                    } else if (typeof Arrow.tableFrom !== 'undefined') {
                        table = Arrow.tableFrom(uint8Array);
                    } else if (typeof Arrow.read !== 'undefined') {
                        table = Arrow.read(uint8Array);
                    } else {
                        throw new Error('No compatible Arrow parsing method found');
                    }
                    
                    console.log('Successfully parsed table:', {
                        numRows: table.numRows,
                        numCols: table.numCols,
                        schema: table.schema.fields.map(f => ({ name: f.name, type: f.type.toString() }))
                    });
                    
                    output.innerHTML += '<div class="success">✅ File parsed successfully!</div>';
                } catch (error) {
                    console.error('Parsing failed:', error);
                    output.innerHTML += '<div class="error">❌ Parsing failed: ' + error.message + '</div>';
                }
            };
            
            reader.onerror = function() {
                output.innerHTML += '<div class="error">❌ File reading failed</div>';
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Auto-test libraries on load
        window.addEventListener('load', function() {
            testLibraries();
        });
    </script>
</body>
</html> 